---
layout: default_post
---

目前在构建一个中型的项目，项目允许用户自定义大多数模块的颜色、字体等样式，并且需要在自定义界面实现实时预览。因此有大量数据交互和视图的动态渲染。如果用jQuery手工操作DOM，也许会导致痔疮爆炸。藉这个机会学习了一下Vue.js，这里提供一个自己琢磨的表单联动组件。

关于Vue.js的介绍，我这里就不引用了，要了解的到[这里](https://vuejs.org.cn/)

表单联动的核心是利用了Vue.js的条件渲染指令`v-show`或`v-if`，用这两个指令已经可以实现最基本的联动功能：

```javascript
<template id="linkage-form">
  <select v-model="fields">
    <option value="cat">Cat</option>
    <option value="dog">Dog</option>
    <option value="grandma">Grandma</option>
  </select>
  <span>Cat Name:</span><input type="text" v-show="fields=='cat'">
  <span>Cat Age:</span><input type="text" v-show="fields=='cat'">
  <span>Dog Name:</span><input type="text" v-show="fields=='dog'">
  <span>Dog Age:</span><input type="text" v-show="fields=='dog'">
  <span>Grandma Name:</span><input type="text" v-show="fields=='grandma'">
  <span>Grandma Age:</span><input type="text" v-show="fields=='grandma'">
</template>

<script>
  Vue.component('my-component', {
    template: '#linkage-form'
    data: function() {
      return {
        fields: ''
      }
    }
  });
</script>
```

以上组件在选择`cat`时会显示Cat Name和Cat Age， 在选择`dog`时会显示Dog Name和Dog Age。

但是有时候，我们需要一个选项控制多个类别的表单显示，比如我们要添加一个`pet`选项，选择后显示Cat和Dog，但Grandma应该不是宠物，所以不显示。而在选择`people`选项时显示Grandma。

当然这里可以将代码改成以下，利用表达式为每个结果增加一个筛选条件：

```javascript
<template id="linkage-form">
  <select v-model="fields">
    <option value="cat">Cat</option>
    <option value="dog">Dog</option>
    <option value="grandma">Grandma</option>
    <option value="pet">Pet</option>
    <option value="people">People</option>
  </select>
  <span>Cat Name:</span><input type="text" v-show="fields=='cat' || fields=='pet'">
  <span>Cat Age:</span><input type="text" v-show="fields=='cat' || fields=='pet'">
  <span>Dog Name:</span><input type="text" v-show="fields=='dog' || fields=='pet'">
  <span>Dog Age:</span><input type="text" v-show="fields=='dog' || fields=='pet'">
  <span>Grandma Name:</span><input type="text" v-show="fields=='grandma' || fields=='people'">
  <span>Grandma Age:</span><input type="text" v-show="fields=='grandma' || fields=='people'">
</template>

<script>
  Vue.component('my-component', {
    template: '#linkage-form'
    data: function() {
      return {
        fields: ''
      }
    }
  });
</script>
```

以上代码也可以实现拓展，但是如果可以仅通过option value来告诉组件进行多个条件的筛选，可以大大代码的可维护性。

这里，我们可以利用`computed`计算属性，将赋予option的多个条件转换成对象进行筛选：

```javascript
<template id="linkage-form">
  <select v-model="fieldStr">
    <option value="cat">Cat</option>
    <option value="dog">Dog</option>
    <option value="grandma">Grandma</option>
    <option value="cat | dog">Pet</option>
    <option value="grandma">People</option>
  </select>
  <span>Cat Name:</span><input type="text" v-show="fields.cat">
  <span>Cat Age:</span><input type="text" v-show="fields.cat">
  <span>Dog Name:</span><input type="text" v-show="fields.dog">
  <span>Dog Age:</span><input type="text" v-show="fields.dog">
  <span>Grandma Name:</span><input type="text" v-show="fields.grandma">
  <span>Grandma Age:</span><input type="text" v-show="fields.grandma">
</template>

<script>
  Vue.component('my-component', {
    template: '#linkage-form'
    data: function() {
      return {
        fieldStr: ''
      }
    },
    computed: {
      fields: {
        get: function() {
          var arrStr = this.fieldStr;
          var arr = arrStr.split('|');
          var str = '{';
          for(var i=0; i<arr.length; i++) {
            str+='"'+$.trim(arr[i])+'":true';
            if(i != arr.length-1) { str+=','; }
          }
          str+='}';
          return $.parseJSON(str);
        },
        set: function(val) {
          this.fieldStr = val;
        }
      }
    }
  });
</script>
```

我们把option值与`fieldStr`绑定，而当获取`fields`对象的属性时，会通过计算，再将字符串`fieldStr`转换成一个对象。上例中，当我选择Pet选项时，`fieldStr`的值为"cat &#124; dog"`，而`fields`则会同步更新为对象`{cat:true, dog:true}`，最后，视图也会被同步更新。