---
layout: default_post
---

> 上一篇介绍了用 Jest 做单元测试，今天我们将在此基础上介绍如何测试 Vue 组件。如果你对 Jest 还不熟悉，可以先去看一下上一篇文章，此篇不再对 Jest 的基本配置做重复赘述。

比起工具库，对视图组件进行单元测试往往让人不知从何入手 ———— 如何抽象组件的方法？如何模拟组件生命周期？实际上，当我们测试 Vue 组件时，只需要保证每个被测试的方法是幂等的 ———— 固定的输入得到固定的输出。我们不需要过度关注在浏览器里渲染出的效果是否正确，这是交给 Vue 去完成的工作，我们只需保证交给 Vue 的数据是正确的即可。

## 配置

如果你的 Vue 组件中还没有安装 `vue`，你需要先安装 `vue` 运行所需要的环境：

```powershell
npm install vue --save
npm install vue-template-compiler --save-dev
```

*注意保持 `vue` 和 `vue-template-compiler` 的版本一致*，或者你可以在开发组件前直接用 vue 脚手架启动，虽然这会使你的组件增加不必要的包。

Vue 已经提供了官方的单元测试工具 `@vue/test-utils`，要配合 Jest 进行 Vue 组件的单元测试，我们只需安装 `vue-jest` `@vue/test-utils` 及 `jest-serializer-vue`：

```powershell
npm install vue-jest @vue/test-utils jest-serializer-vue --save-dev
```

然后在 `package.json` 中配置 `jest` 参数：

```json
{
  "jest": {
    "transform": {
      ".+\\.(vue)$": "<rootDir>/node_modules/vue-jest"
    },
    "snapshotSerializers": [
      "<rootDir>/node_modules/jest-serializer-vue"
    ],
    "collectCoverageFrom": [
      "src/**/*.{js,jsx,ts,tsx,vue}",
      "!**/node_modules/**",
      "!**/*.d.ts"
    ]
  }
}
```

## 使用

通过以上简单的配置，我们已经可以开始编写 Vue 的单元测试了。让我们先创建一个简单的 Vue 单文件组件 `message-card.vue`：

template:

```html
<div class="message-card">{{message}}</div>
```

script（方便起见我使用了 esm 的写法，你如果需要使用可能要先安装 Babel）:

```javascript
export default {
  props: {
    name: {
      type: String,
      default: 'Karl'
    }
  },
  computed: {
    message () {
      return 'Hello, ' + this.name + '.'
    }
  }
}
```

以上是一个最简单的 Vue 组件，只有一个 `props`，因此我们对传入不同 `props` 的情况进行测试。让我们再新建一个编写测试用例的 `message-card.spec.js`:

```javascript
import Vue from 'vue'
import MessageCard from './message-card.vue'
import { shallowMount } from '@vue/test-utils'

describe('测试 message-card 组件', () => {
  test('name 默认为 Karl', () => {
    const messageCard = shallowMount(MessageCard)
    expect(messageCard.vm.message).toBe('Hello, Karl.')
  })

  test('当指定 name 时会显示对应消息', () => {
    const messageCard = shallowMount(MessageCard, {
      propsData: {
        name: 'Leo'
      }
    })
    expect(messageCard.vm.message).toBe('Hello, Leo.')
  })
})
```

如此便对组件在接收不同 `props` 时的情况进行了测试。当然，`@vue/test-utils` 的能力远不止于此。它几乎可以模拟任何对组件的数据操作、事件、渲染等，如果你想详细了解，可以学习[官方文档](https://vue-test-utils.vuejs.org/)。
